<div class="panel panel-default">

    <div class="panel-body" id="top-dashboard">
        افزونه
    </div>

</div>

<div  class="row" id="zone">

  <!--<div class="col-md-12" id="plugin-holder">

      <div class="item-holder">

           <div
                          ng-repeat="item in list5"
                          data-drop="true" ng-model='list5'
                          jqyoui-droppable="{index: {{$index}}}"
                  >
                      <div class="item "
                           ng-class="{'item-notify' : item.type=='notify', 'item-filter':item.type=='filter'  }"
                              data-drag="{{item.drag}}"
                              data-jqyoui-options="{revert: 'invalid'}"
                              ng-model="list5"
                              jqyoui-draggable="{index: {{$index}},placeholder:'keep',deepCopy:true}"
                              ng-hide="!item.title">
                          {{item.title}}
                      </div>
                  </div>
          <div class="clearfix"></div>
      </div>


      <div class='content'>
          <div class="row-fluid">
              <ul class="thumbnails">

                  <li class="span3" style='margin-left:10px;'>
                      <div class="thumbnail" data-drop="true" ng-model='vm.list1' jqyoui-droppable="{multiple:true}">
                          <div class="caption">
                              <div class="item"
                                   ng-class="{'item-notify' : item.type=='notify', 'item-filter':item.type=='filter'  }"
                                   ng-repeat="item in vm.list1"
                                   ng-show="item.title"
                                   data-drag="true"
                                   data-jqyoui-options="{revert: 'invalid'}"
                                   ng-model="vm.list1"
                                   jqyoui-draggable="{index: {{$index}},animate:true}"
                                   uib-popover-template="'filterTemplate.html'"
                              >
                                  {{item.title}}

                                  <script ng-if="item.type=='notify'" type="text/ng-template" id="filterTemplate.html">
                                      <div>
                                          In Notify Template
                                      </div>
                                      <div class="form-group">
                                          <label></label>
                                          <input type="text" placeholder="عنوان هشدار" class="form-control">
                                      </div>
                                  </script>

                                  <script ng-if="item.type=='filter'" type="text/ng-template" id="filterTemplate.html">
                                      <div>
                                          In Filter Template
                                      </div>
                                      <div class="form-group">
                                          <label></label>
                                          <input type="text" placeholder="عنوان فیلتر" class="form-control">
                                      </div>
                                  </script>

                              </div>
                          </div>
                      </div>
                  </li>

              </ul>
          </div>
      </div>

      {{vm.list1 | json}}

  </div>-->
    <div class="col-md-12" id="plugin-holder">
        <!-- new State -->
        <div style="padding: 15px;">
            <p ng-click="addState()">New State +</p>
            <form name="sup-form" ng-submit="check(state)"
                  class="box state-box"  ng-repeat = "state in states track by $index">
                <p>State:
                    <input type="text" ng-blur="state['name']=checkForNull(state['name']);" ng-model="state['name']"  required>
                </p>
                <p>
                    Agent ID:
                    <select ng-model="state['agent_id']" ng-options="key as key for  (key , value) in agents" required>
                        <option></option>
                    </select>
                </p>
                <p>
                    type:
                    <select ng-model="state['type']" ng-options="x for x in stateTypes" required>
                        <option></option>
                    </select>
                </p>

                <!-- new condition -->
                <p ng-click="addCond(state)" ng-if="state['type'] == 'filter'">New Condition +</p>
                <div  class="box condition-box" ng-if="state['type'] == 'filter'"
                     ng-model="state['conditions']" ng-repeat="cond in state['conditions'] track by $index">

                    <p>
                        Device ID:
                        <select ng-model="deviceConf"
                                ng-change="cond['device_id'] = deviceConf.device_id; cond['type'] = deviceConf.type;"
                                ng-options="value as value.device_id for  (key , value) in agents[state['agent_id']] |
                                 filter:{action_type: state['type']}" required>
                            <option></option>
                        </select>
                    </p>
                    <p>Type: <span ng-bind="cond['type']" ></span></p>
                    <p>
                        Action:
                        <select ng-model="actionNext"
                                ng-change="cond['action']['nextStep'] = actionNext.name"
                                ng-options="value.name for value in states" required>
                            <option></option>
                        </select>
                    </p>

                    <!-- new St -->
                    <p ng-click="addSt(cond)" >New State +</p>
                    <div class="box st-box"
                         ng-model=" cond['states']" ng-repeat="st in cond['states'] track by $index">

                        <p>
                            Type:
                            <select ng-model="st['type']"
                                    ng-options="value as value for  (key , value) in deviceConf.state" required>
                                <option></option>
                            </select>
                        </p>
                        <p>value: <input type="text" ng-model="st['device_id']" required></p>
                        <p>Op: <input type="text" ng-model="st['op']" required></p>
                        <p>Logic: <input type="text" ng-model="st['logic']"></p>

                        <button type="button" ng-click="deleteSt(cond,st)">
                            Delete
                        </button>

                    </div>

                    <button type="button" ng-click="deleteCond(state,cond)">
                        Delete
                    </button>
                </div>

                <p ng-if="state['type'] == 'filter'" >
                    Else:
                    <select ng-model="elseNext"
                            ng-change="state['else']['nextStep'] = elseNext.name"
                            ng-options="value.name for value in states" required>
                        <option></option>
                    </select>
                </p>
                <p ng-if="state['type'] == 'notif'" >
                    Next Step:
                    <select ng-model="notifNext"
                            ng-change="state['nextStep'] = notifNext.name"
                            ng-options="value.name for value in states" required>
                        <option></option>
                    </select>
                </p>

                <!-- new Action -->
                <p ng-click="addAction(state)" ng-if="state['type'] == 'notif'">New Action +</p>
                <div  class="box action-box" ng-if="state['type'] == 'notif'"
                      ng-model="state['actions']" ng-repeat="act in state['actions'] track by $index"
                      ng-init="act['agent_id'] = state['agent_id']">

                    <p>Type: <input type="text"  ng-model="act['type']" required></p>
                    <p>
                        Settings:
                        <select ng-model="settings_item" ng-options="x.item for x in notifSettings"
                                ng-change="fillSettings(act,settings_item.item)" required>
                            <option></option>
                        </select>

                        <select ng-if="settings_item.item != undefined"
                                ng-model="act['settings'][settings_item.item]"
                                ng-options="x for x in settings_item.values" required>
                            <option></option>
                        </select>
                    </p>

                    <!-- new Device -->
                    <p ng-click="addDevice(act)">New Device +</p>
                    <div ng-model="act['device_id']" ng-repeat="device in act['device_id'] track by $index">
                        <span>Device ID: <input type="text"
                                                ng-blur=" act['device_id'][$index] = device"
                                                ng-model="device" required></span>

                        <button type="button" ng-click="deleteDevice(act,device)">
                            Delete
                        </button>

                    </div>

                    <button type="button" ng-click="deleteAct(state,act)">
                        Delete
                    </button>
                </div>

                <button type="submit" >
                    Check
                </button>
                <button type="button" ng-click="deleteState(state)">
                    Delete
                </button>

            </form>
            <button ng-click="convertToVJson()">
                convert
            </button>
            <div class="box">
                {{myjson}}
            </div>

        </div>
    </div>


</div>
